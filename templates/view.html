{% extends "base.html" %}

{% block title %}{{ item.title }} - Issue Tracker{% endblock %}

{% block content %}
<div class="item-detail-container">
    <div class="item-header">
        <div class="item-title-section">
            <h1>{{ item.title }}</h1>
            <div class="item-meta">
                <span class="item-id">ID: {{ item.id }}</span>
            </div>
        </div>
        <div class="item-actions">
            <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê Back to Menu</a>

            {% if current_user.id == item.user_id %}
                <a href="{{ url_for('edit', item_id=item.id) }}" class="btn btn-edit">Edit</a>
                <a href="{{ url_for('delete', item_id=item.id) }}" class="btn btn-delete"
                onclick="return confirm('Delete this item?')">Delete</a>
                <a href="{{ url_for('share', item_id=item.id) }}" class="btn btn-primary">Share</a>
            {% elif item.can_edit_status or item.can_edit_assignee %}
                <a href="{{ url_for('edit', item_id=item.id) }}" class="btn btn-edit">Edit (Shared)</a>
            {% endif %}
        </div>
    </div>

    <div class="item-content">
        <div class="item-main">
            <div class="item-description">
                <h3>Description</h3>
                <p>{{ item.description or 'No description provided.' }}</p>
            </div>

            <div class="item-details-grid">
                <div class="detail-card">
                    <h4>Status</h4>
                    <span class="status-badge status-{{ item.status.lower().replace(' ', '-') }}">
                             {{ item.status }}
                    </span>
                </div>

                <div class="detail-card">
                    <h4>Priority</h4>
                    <span class="priority-badge priority-{{ item.priority }}">
                        {{ item.priority }}
                    </span>
                </div>

                <div class="detail-card">
                    <h4>Assignee</h4>
                    <p>{{ item.assignee or 'Unassigned' }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Comments Section -->
    <div class="comments-section">
        <h3>Comments</h3>
        {% if notes %}
            <div class="comments-list">
                {% for note in notes %}
                <div class="comment">
                    <div class="comment-header">
                        <span class="comment-author">{{ note.author }}</span>
                        <span class="comment-timestamp">{{ note.timestamp }}</span>
                    </div>
                    <div class="comment-content">
                        {{ note.content }}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No comments yet.</p>
        {% endif %}

        <div class="add-comment">
            <h4>Add Comment</h4>
            <form method="POST" action="{{ url_for('add_comment') }}" class="comment-form">
                <input type="hidden" name="item_id" value="{{ item.id }}">
                <div class="form-group">
                    <input type="text" name="author" placeholder="Your name" required class="form-input">
                </div>
                <div class="form-group">
                    <textarea name="content" placeholder="Write your comment..." required rows="3" class="form-textarea"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Add Comment</button>
            </form>
        </div>
    </div>

    {% if shares %}
    <div class="shares-section">
        <h3>Shared With</h3>
        <ul>
            {% for share in shares %}
            <li>
                {{ share.username }}
                {% if share.can_edit_status %} (can edit status){% endif %}
                {% if share.can_edit_assignee %} (can edit assignee){% endif %}
                {% if current_user.id == item.user_id %}
                <form method="POST" action="{{ url_for('unshare', task_id=item.id, user_id=share.user_id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-small btn-delete">Remove</button>
                </form>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
{% endblock %}
